# ====================================
# GymTracker on https://zanserver.sytes.net/gymtracker/
# Place this file anywhere and Include it from httpd.conf
# Example: Include "C:/filepubblici/gymtracker/apache-gymtracker.conf"
# ====================================

# Required modules (uncomment in httpd.conf if not already loaded)
# LoadModule rewrite_module modules/mod_rewrite.so
# LoadModule proxy_module modules/mod_proxy.so
# LoadModule proxy_http_module modules/mod_proxy_http.so
# LoadModule headers_module modules/mod_headers.so
# LoadModule expires_module modules/mod_expires.so
# LoadModule deflate_module modules/mod_deflate.so

# Static files (frontend)
Alias /gymtracker "C:/filepubblici/gymtracker/public"

<Directory "C:/filepubblici/gymtracker/public">
    Options Indexes FollowSymLinks
    AllowOverride All
    Require all granted
    DirectoryIndex index.html

    # Security headers (safe defaults)
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"

    # Cache static assets
    <FilesMatch "\.(css|js|png|jpg|jpeg|gif|svg|ico|woff|woff2|ttf|eot)$">
        ExpiresActive On
        ExpiresDefault "access plus 7 days"
        Header append Cache-Control "public, immutable"
    </FilesMatch>
    <FilesMatch "\.(html)$">
        ExpiresActive On
        ExpiresDefault "access plus 1 hour"
        Header set Cache-Control "public, must-revalidate"
    </FilesMatch>

    # Never serve sensitive files
    <FilesMatch "\.(env|sql|db|sqlite|md|bat|sh|log)$">
        Require all denied
    </FilesMatch>
</Directory>

# Reverse proxy for API â†’ Node.js
ProxyPreserveHost On
ProxyTimeout 300

# API under the same origin
ProxyPass        /gymtracker/api/ http://localhost:3007/api/
ProxyPassReverse /gymtracker/api/ http://localhost:3007/api/

# (Optional) WebSocket paths in future
# ProxyPass        /gymtracker/ws/ ws://localhost:3007/ws/
# ProxyPassReverse /gymtracker/ws/ ws://localhost:3007/ws/

# GZip
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain text/html text/xml text/css
    AddOutputFilterByType DEFLATE application/xml application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml application/javascript application/x-javascript
</IfModule>

