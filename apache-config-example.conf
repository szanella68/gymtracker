# GymTracker Apache Virtual Host Configuration
# File: httpd.conf o sites-enabled/gymtracker.conf
# Aggiungi questa configurazione al tuo Apache esistente

# Moduli richiesti
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule headers_module modules/mod_headers.so
LoadModule expires_module modules/mod_expires.so
LoadModule deflate_module modules/mod_deflate.so

# Alias per servire GymTracker da directory personalizzata
Alias /gymtracker "C:/FilePubblici/gymtracker/public"

<Directory "C:/FilePubblici/gymtracker/public">
    Options Indexes FollowSymLinks
    AllowOverride All
    Require all granted
    
    # Headers per CORS (supporta Node.js backend)
    Header always set Access-Control-Allow-Origin "https://zanserver.sytes.net"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
    Header always set Access-Control-Allow-Credentials "true"
    
    # Cache ottimizzato per app dinamica
    <filesMatch "\.(css|js|png|jpg|jpeg|gif|svg|ico|woff|woff2|ttf|eot)$">
        ExpiresActive On
        ExpiresDefault "access plus 7 days"
        Header set Cache-Control "public, max-age=604800"
    </filesMatch>
    
    <filesMatch "\.(html|htm)$">
        ExpiresActive On
        ExpiresDefault "access plus 1 hour"
        Header set Cache-Control "public, max-age=3600"
    </filesMatch>
    
    # Compressione Gzip
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/plain
        AddOutputFilterByType DEFLATE text/html
        AddOutputFilterByType DEFLATE text/xml
        AddOutputFilterByType DEFLATE text/css
        AddOutputFilterByType DEFLATE application/xml
        AddOutputFilterByType DEFLATE application/xhtml+xml
        AddOutputFilterByType DEFLATE application/rss+xml
        AddOutputFilterByType DEFLATE application/javascript
        AddOutputFilterByType DEFLATE application/x-javascript
        AddOutputFilterByType DEFLATE application/json
    </IfModule>
    
    # Sicurezza - Nascondere file sensibili
    <FilesMatch "\.(env|log|sql|db|sqlite|json|md|bat|sh)$">
        Order allow,deny
        Deny from all
    </FilesMatch>
    
    # Bloccare accesso a directory di sistema
    <DirectoryMatch "/(node_modules|database|config|routes|middleware)">
        Order allow,deny
        Deny from all
    </DirectoryMatch>
</Directory>

# Reverse proxy per API Node.js (porta 3007)
ProxyPreserveHost On
ProxyPass /gymtracker/api/ http://localhost:3007/api/
ProxyPassReverse /gymtracker/api/ http://localhost:3007/api/

# Proxy timeout settings (opzionale)
ProxyTimeout 300
ProxyBadHeader Ignore

# Log personalizzati per GymTracker (opzionale)
# LogFormat "%h %l %u %t \"%r\" %>s %O \"%{Referer}i\" \"%{User-Agent}i\"" gymtracker
# CustomLog logs/gymtracker-access.log gymtracker
# ErrorLog logs/gymtracker-error.log

# SSL Configuration (se necessario)
# <IfModule mod_ssl.c>
# <VirtualHost *:443>
#     ServerName zanserver.sytes.net
#     DocumentRoot "C:/FilePubblici"
#     
#     SSLEngine on
#     SSLCertificateFile "path/to/certificate.crt"
#     SSLCertificateKeyFile "path/to/private.key"
#     
#     # Include GymTracker configuration
#     Include "path/to/gymtracker-config.conf"
# </VirtualHost>
# </IfModule>

# Redirect HTTP to HTTPS (se necessario)
# <VirtualHost *:80>
#     ServerName zanserver.sytes.net
#     Redirect permanent / https://zanserver.sytes.net/
# </VirtualHost>